<view class="container">
  <view class="content-body" wx:if="{{paper}}">
    <view class="tag-header">
      <view 
        wx:for="{{paper.tags}}" 
        wx:key="index" 
        class="top-badge tag-color-{{index % 4}}"
      >{{item}}</view>
      <text class="date-text">{{paper.publishedText || '2026-02-19'}}</text>
    </view>

    <view class="main-title">{{paper.title}}</view>

    <view class="author-section">
      <view class="avatar-group">
        <view class="avatar-circle avt-1"></view>
        <view class="avatar-circle avt-2"></view>
      </view>
      <view class="author-info">
        <text class="author-name">{{paper.authorsText}}</text>
        <text class="author-role">PRIMARY AUTHORS</text>
      </view>
    </view>

    <view class="abstract-card">
      <view class="quote-icon">"</view>
      <view class="card-label">Abstract</view>
      <view class="abstract-text">{{paper.abstract}}</view>
    </view>

    <view class="section-header">
      <text>Paper Metadata</text>
    </view>

    <view class="insight-card">
      <view class="insight-icon icon-yellow"></view>
      <view class="insight-content">
        <text class="insight-title">Citations</text>
        <text class="insight-desc">{{paper.citationCount}} total citations</text>
      </view>
    </view>

    <view class="insight-card">
      <view class="insight-icon icon-red"></view>
      <view class="insight-content">
        <text class="insight-title">Publication Venue</text>
        <text class="insight-desc">{{paper.venue || 'ArXiv / Conference'}}</text>
      </view>
    </view>
    <!-- --- è®¨è®ºåŒº --- -->
<view class="discussion-section">
  <view class="discussion-header">
    <text class="discussion-title">Comments ({{comments.length}})</text>
    <view class="comment-sort-group">
      <view
        class="sort-chip {{commentSortBy === 'time' ? 'active' : ''}}"
        data-sort="time"
        bindtap="onChangeCommentSort"
      >
        Latest
      </view>
      <view
        class="sort-chip {{commentSortBy === 'likes' ? 'active' : ''}}"
        data-sort="likes"
        bindtap="onChangeCommentSort"
      >
        Top
      </view>
    </view>
  </view>

  <view wx:if="{{commentsLoading}}" class="comment-state">Loading comments...</view>
  <view wx:elif="{{commentsError}}" class="comment-state comment-state-error">{{commentsError}}</view>
  <view wx:elif="{{!comments.length}}" class="comment-state">No comments yet. Be the first one.</view>

  <view wx:else>
    <view 
      wx:for="{{comments}}" 
      wx:key="id" 
      class="comment-card"
    >
      <view class="comment-avatar">
        {{item.initial}}
      </view>

      <view class="comment-body">
        <view class="comment-meta">
          <text class="comment-name">{{item.name}}</text>
          <text class="comment-time">{{item.timeText}}</text>
        </view>

        <view class="comment-text">
          {{item.content}}
        </view>

        <view class="comment-actions">
          <view
            class="comment-like-btn {{item.likedByMe ? 'active' : ''}}"
            data-id="{{item.id}}"
            bindtap="onToggleCommentLike"
          >
            ğŸ‘ {{item.likeCount}}
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
    <view class="footer-spacer"></view>
  </view>

<!-- --- åº•éƒ¨è¾“å…¥æ  --- -->
<view class="bottom-input-bar">
  <view class="action-buttons">
    <button class="action-btn btn-light" bindtap="onCopyLink">å¤åˆ¶é“¾æ¥</button>
    <button class="action-btn btn-dark" bindtap="onOpenLink">æ‰“å¼€æç¤º</button>
  </view>

  <view class="input-row">
    <view class="input-wrapper">
      <input 
        class="comment-input" 
        placeholder="Add a comment..." 
        confirm-type="send"
        bindconfirm="onSendComment"
        value="{{newComment}}"
        bindinput="onInputComment"
      />
      <view class="send-btn" bindtap="onSendComment">
        <text>â¤</text>
      </view>
    </view>
    
    <view class="favorite-btn {{isFavorite ? 'active' : ''}}" bindtap="onToggleFavorite">
      <text class="fav-icon">{{isFavorite ? 'â¤ï¸' : 'â™¡'}}</text>
    </view>
  </view>
</view>
</view>
