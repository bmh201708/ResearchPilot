<view class="container">
  <view class="nav-bar">
    <view class="brand">
      <view class="brand-icon">
        <view class="flask-icon"></view>
      </view>
      <text class="brand-text">DISCOVERY</text>
    </view>
    <view class="top-btns">
      <view class="icon-btn" bindtap="onSwitchToCard">
        <image class="btn-image" src="/images/explore/change.png" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <view class="page-header">
    <view class="title-line">Explore</view>
    <view class="title-line highlight">Fresh Ideas</view>
  </view>

  <view class="search-panel">
    <input
      class="search-input"
      type="text"
      value="{{keywords}}"
      bindinput="onKeywordInput"
      bindconfirm="onSearchTap"
      confirm-type="search"
      placeholder="输入关键词检索论文，留空使用默认关键词"
    />
    <button class="search-btn" loading="{{isLoading}}" bindtap="onSearchTap">搜索</button>
  </view>
  <view class="search-meta">
    <text class="search-meta-text">当前关键词：{{appliedKeywords || "默认关键词"}}</text>
  </view>
  <view wx:if="{{source==='local_cache'}}" class="search-warning">
    Semantic Scholar 限流，已自动回退到本地缓存
  </view>

  <view wx:if="{{isLoading}}" class="state-text">正在获取推荐论文...</view>
  <view wx:elif="{{errorMsg}}" class="state-text state-error">{{errorMsg}}</view>
  <view wx:elif="{{!papers.length}}" class="state-text">暂无结果，换个关键词试试</view>

  <view wx:else class="discovery-grid">
    <view class="grid-column">
      <view class="card idea-card" wx:for="{{leftPapers}}" wx:key="id" bindtap="onPaperTap" data-id="{{item.id}}">
        <view class="card-content">
          <view class="tag-label mint-text">{{item.yearText}}</view>
          <view class="card-title">{{item.title}}</view>
          <view class="card-abstract">{{item.abstractShort}}</view>
          <view class="card-footer">
            <text class="author-text">{{item.authorsText}}</text>
            <text class="time-text">{{item.citationText}}</text>
          </view>
        </view>
      </view>
    </view>

    <view class="grid-column">
      <view class="card idea-card" wx:for="{{rightPapers}}" wx:key="id" bindtap="onPaperTap" data-id="{{item.id}}">
        <view class="card-content">
          <view class="tag-label blue-text">{{item.yearText}}</view>
          <view class="card-title">{{item.title}}</view>
          <view class="card-abstract">{{item.abstractShort}}</view>
          <view class="card-footer">
            <text class="author-text">{{item.authorsText}}</text>
            <text class="time-text">{{item.citationText}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
